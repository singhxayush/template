# To install dependencies

```sh
bun install
```

```sh
# To initialise eslint
bun x @antfu/eslint-config@latest
```

To run:

```sh
bun run dev
```

open `http://localhost:3000`

Here is the **Final Raw Project Structure**. This is designed as a **Context-Driven Modular Monolith**.

It is optimized for **Bun** performance, **Developer Experience**, and **Future Scalability**. Every directory represents a boundary. If you ever need to extract the `billing` context into its own micro-service, you simply cut the `src/contexts/billing` folder and move it to a new repo.

### ğŸ“ Project Root

```text
.
â”œâ”€â”€ .env                    # Environment variables (DB_URL, SECRETS)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ bun.lockb               # Bun's binary lockfile
â”œâ”€â”€ drizzle.config.ts       # Drizzle Kit configuration (Global migration manager)
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ src/                    # Application Source Code

```

### ğŸ“‚ Source Directory (`src`)

#### 1. The Core Infrastructure (`src/app`)

This folder handles the "Plumbing" of your monolith. It doesn't know about "Users" or "Orders"; it just knows how to start a server.

```text
src/app
â”œâ”€â”€ index.ts                # Main Entry Point (Bun.serve implementation)
â”œâ”€â”€ app.ts                  # Hono App Factory (Registers middlewares & mounts contexts)
â”œâ”€â”€ server.ts               # Server Config (Port, reusePort, graceful shutdown)
â””â”€â”€ openapi.ts              # Scalar / Swagger Documentation Generator Logic

```

#### 2. The Shared Kernel (`src/shared`)

Code that is strictly generic and reusable. **Rules:** Contexts can import from here, but this folder **cannot** import from Contexts.

```text
src/shared
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ env.ts              # Zod-validated Environment Variables
â”‚   â””â”€â”€ logger.ts           # JSON Logger Setup (Pino or Bun's native)
â”œâ”€â”€ db
â”‚   â”œâ”€â”€ client.ts           # Exports 'db' (Drizzle) and 'qb' (Kysely) instances
â”‚   â”œâ”€â”€ schema.ts           # Base DB types/enums shared globally
â”‚   â””â”€â”€ migrations/         # SQL Migration files (Generated by Drizzle Kit)
â”œâ”€â”€ errors
â”‚   â”œâ”€â”€ app-error.ts        # Custom Error Classes (e.g., NotFoundError)
â”‚   â””â”€â”€ handler.ts          # Global Error Handler Middleware
â”œâ”€â”€ middlewares
â”‚   â”œâ”€â”€ auth.middleware.ts  # JWT/Session validation middleware
â”‚   â”œâ”€â”€ request-id.ts       # Adds Correlation ID to headers (Vital for tracing)
â”‚   â””â”€â”€ rate-limiter.ts     # Redis/Memory based Rate Limiter
â””â”€â”€ utils
    â”œâ”€â”€ result.ts           # "Result Pattern" utility (Success/Failure types)
    â””â”€â”€ date.ts

```

#### 3. The Business Domains (`src/contexts`)

This is where the magic happens. Each folder here is a self-contained "Service-in-waiting."

```text
src/contexts
â”œâ”€â”€ auth                    # [Context: Authentication & Identity]
â”‚   â”œâ”€â”€ api                 # The HTTP Layer (Controllers)
â”‚   â”‚   â”œâ”€â”€ auth.routes.ts  # OpenAPIHono Route Definitions
â”‚   â”‚   â””â”€â”€ auth.docs.ts    # OpenAPI Route Metadata/Examples
â”‚   â”œâ”€â”€ core                # The Business Logic Layer (Services)
â”‚   â”‚   â”œâ”€â”€ auth.service.ts # Pure logic (Login, Signup, Reset Password)
â”‚   â”‚   â””â”€â”€ token.service.ts
â”‚   â”œâ”€â”€ data                # The Persistence Layer (Database)
â”‚   â”‚   â”œâ”€â”€ auth.schema.ts  # Drizzle Schema (users, sessions tables)
â”‚   â”‚   â””â”€â”€ auth.repo.ts    # Kysely Queries (complex selects)
â”‚   â”œâ”€â”€ domain              # The Type Layer
â”‚   â”‚   â””â”€â”€ auth.contracts.ts # Zod Schemas for Input/Output validation
â”‚   â””â”€â”€ index.ts            # Public Barrier (Exports ONLY the Routes/Types needed by app.ts)
â”‚
â”œâ”€â”€ billing                 # [Context: Payments & Subscriptions]
â”‚   â”œâ”€â”€ api
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ core
â”‚   â”‚   â”œâ”€â”€ payment.processor.ts
â”‚   â”‚   â””â”€â”€ invoice.generator.ts
â”‚   â”œâ”€â”€ data
â”‚   â”‚   â””â”€â”€ billing.schema.ts
â”‚   â””â”€â”€ events              # [Event Driven Architecture]
â”‚       â””â”€â”€ billing.events.ts # Defines events like "PaymentSucceeded"
â”‚
â””â”€â”€ ... (other contexts)

```

#### 4. The Integration Layer (`src/integrations`)

Strict isolation for third-party external services. If you switch from Stripe to PayPal, you only change files here.

```text
src/integrations
â”œâ”€â”€ email
â”‚   â”œâ”€â”€ email.client.ts     # Generic Interface (sendEmail)
â”‚   â””â”€â”€ resend.provider.ts  # Implementation (e.g., Resend / AWS SES)
â”œâ”€â”€ storage
â”‚   â””â”€â”€ s3.provider.ts      # AWS S3 / Cloudflare R2 implementation
â””â”€â”€ payment
    â””â”€â”€ stripe.provider.ts

```

---

### Key Architectural Decisions in this Structure:

1. **`src/contexts/*/data/*.schema.ts`**:
* You define Drizzle schemas **inside the context**.
* In your root `drizzle.config.ts`, you will point to `src/contexts/**/*.schema.ts`. This allows Drizzle to see the "Whole DB," but allows you to keep the file physically inside the module.


2. **`src/contexts/*/index.ts`**:
* This is your **"Module Barrier."**
* Only export the main Router and shared Types. *Never* export the internal Service or Repo. This forces other parts of the app to use the API (or an Event) to interact with this module.


3. **`src/app/index.ts` vs `src/app/app.ts**`:
* `app.ts` creates the `Hono` instance and mounts routes (`app.route('/auth', authRouter)`).
* `index.ts` imports the app and feeds it to `Bun.serve`. This separation is critical for writing **Integration Tests** (you can spin up the `app` in a test without binding a real network port).


4. **`migrations/` location**:
* Placed in `shared/db`. Even though schemas are distributed in contexts, migrations are usually linear and sequential for the whole monolith, so they live centrally.